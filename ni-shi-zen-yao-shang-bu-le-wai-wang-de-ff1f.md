## 3 你是怎么上不了外网的？

### 3.1 从《美国的人权记录》说起

从1977年开始，美国国务院每年都会发布一份[《国别人权报告》](https://en.wikipedia.org/wiki/Country_Reports_on_Human_Rights_Practices)来指责各个国家的人权状况，作为回应，我国国务院每年也会发布一份[《美国的人权记录》](https://zh.wikipedia.org/wiki/美国的人权纪录)。

其中[《2009年美国的人权纪录》](http://www.china-embassy.org/chn/xw/t663715.htm)，除来枪击案、犯罪率、强奸率、非法移民啊什么的，有这么一条让人印象非常深刻：

> 目前全球互联网**根服务器**有13台，其中唯一的主根服务器在美国，其余12台辅根服务器中有9台在美国。

看到这条，各位是否一头雾水？没事，我们一步步来解释。

### 3.2 什么是『IP地址』

就如同我们人所住的地址一样，互联网上的每一台机器都有一个『IP地址』来进行相互通信。没有地址，两个人天各一方，何尝通信，更何况机器。

既然如此，各位，无论你这会儿是用着电脑还是手机，打开[http://www.baidu.com](http://www.baidu.com)，然后搜索一下关键词——IP，然后百度会直接显示你当前的IP地址是多少：

![](/assets/ip.png)

如上图所示，百度反馈给各位的IP地址都是不同的，不过所有的IP地址都由4个数字组成，每个数字占1个字节（即8个比特）。

各位可以找找资料，试着把二进制下8比特表示的最大数——11111111，给转换一下，这个数字等于『2的8次方-1』即255。

### 3.3 你打开[https://www.baidu.com](https://www.baidu.com/)后发生了什么？

这个问题比较大，我们把跟这个章节相关的部分拎出来说。

首先需要明确的是，我们自己有一个IP地址，我们需要访问的网站，他有一个**『域名』**www.baidu.com，而这个域名对应到一个IP地址。

整个过程为了方便理解，我先举个例子：

背景，A和B是多年不联系的老同学，如今A因为家人重病已经家徒四壁，于是想向已经财务自由的B借点钱，在没有互联网的情况下，A只能寄封信给B，然后让B把钱寄给A。

1. 由于长久不联系，A没有B的『通信地址』；
2. A先问『同学C』：你知不知道B的『通信地址』是多少？
3. 『同学C』不知道，不过他继续问了『人脉比较广的同学D』：你知不知道B的『通信地址』是多少？
4. 『人脉比较广的同学D』不知道，然后说我打114查一下；
5. 114把B的『通信地址』查到了发给了『人脉比较广的同学D』；
6. 『人脉比较广的同学D』又把B的『通信地址』发给了『同学C』；
7. 『同学C』又把B的『通信地址』发给了A；
8. A拿着B的『通信地址』，就开始写信了——『家人重病，望寄点钱』；
9. A的信寄到之后，B按照信封上A的『通信地址』，把钱给寄了过来；
10. A收到钱，拿去给家人治病。

如图所示：![](/assets/dns3.png)

好的，稍微学术一点：

1. 你好久没上网了，在浏览器输入www.baidu.com，不过你的浏览器不知道www.baidu.com的『IP地址』；
2. 你的浏览器问附近的『域名服务器』：你知不知道www.baidu.com的『IP地址』是多少？
3. 附近的『域名服务器』不知道，不过它继续问了比较大的『域名服务器』：你知不知道www.baidu.com的『IP地址』是多少？
4. 比较大的『域名服务器』不知道，然后它继续向**『根域名服务器』**查一下；
5. 『根域名服务器』把www.baidu.com的『IP地址』发给了比较大的『域名服务器』；
6. 比较大的『域名服务器』又把www.baidu.com的『IP地址』发给了附近的『域名服务器』；
7. 附近的『域名服务器』又把www.baidu.com的『IP地址』发给了你的浏览器；
8. 你的浏览器拿着www.baidu.com的『IP地址』，就开始通信了——『我要搜东西，把首页发过来』；
9. 你的消息寄到www.baidu.com的服务器之后，www.baidu.com的服务器按照请求包上你的『IP地址』，把『首页』给发了过来；
10. 你的浏览器收到『首页』，开始渲染出首页的页面；

### 3.4 GFW简介

先回到上面那张图，那个紫色的『根域名服务器』，《2009年美国的人权记录》说了，全世界总共就13台，10台都在美国。

好的，现在你打114问一下B的『通信地址』是多少，而114说B这个人不存在，也就是[404 not found](https://zh.wikipedia.org/wiki/HTTP_404)，能知道什么意思了吧？

你也就明白为什么《人权报告》里有这么一条了吧——救命钱借不到了啊。

当然我们可以假设114不会骗你，倘若这个『人脉较广的同学D』骗你呢？他问都不问114，即使他问了，他也只会告诉你B这个人不存在或者告诉你一个假的地址呢？

北京邮电大学前校长——方滨兴院士所研究设计的[**Great Firewall**](https://zh.wikipedia.org/wiki/防火长城)，其中一项重要工作就是使得『人脉较广的同学D』骗了你。

### 3.5 小结

* 明白IP地址的概念；
* 明白我们所访问的**域名**其实对应到了一个IP地址，并懂得获取域名的IP地址的过程；



