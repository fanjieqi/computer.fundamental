# 3 你是怎么上不了外网的？

## 3.1 从《美国的人权记录》说起

从1977年开始，美国国务院每年都会发布一份[《国别人权报告》](https://en.wikipedia.org/wiki/Country_Reports_on_Human_Rights_Practices)来指责各个国家的人权状况，作为回应，我国国务院每年也会发布一份[《美国的人权记录》](https://zh.wikipedia.org/wiki/美国的人权纪录)。

其中[《2009年美国的人权纪录》](http://www.china-embassy.org/chn/xw/t663715.htm)，除了枪击案、犯罪率、强奸率、非法移民啊什么的，有这么一条让人印象非常深刻：

> 目前全球互联网**根服务器**有13台，其中唯一的主根服务器在美国，其余12台辅根服务器中有9台在美国。

看到这条，各位是否一头雾水？没事，我们一步步来解释。

## 3.2 什么是『IP地址』

就如同我们人所住的地址一样，互联网上的每一台机器都有一个『IP地址』来进行相互通信。没有地址，两个人天各一方，何尝通信，更何况机器。

既然如此，各位，无论你这会儿是用着电脑还是手机，打开[https://www.baidu.com](http://www.baidu.com)，然后搜索一下关键词——IP，然后百度会直接显示你当前的IP地址是多少：

![](/assets/ip.png)

如上图所示，百度反馈给各位的IP地址都是不同的，不过所有的IP地址都由4个数字组成，每个数字占1个字节（即8个比特）。

各位可以找找资料，试着把二进制下8比特表示的最大数——11111111，给转换为十进制，这个数字等于『2的8次方-1』即255，可以看出IP地址最大为255.255.255.255。

## 3.3 你打开[https://www.google.com](https://www.baidu.com/)后发生了什么？

这个问题比较大，我们把跟这个章节相关的部分拎出来说。

首先需要明确的是，我们自己有一个IP地址，我们需要访问的网站，他有一个**『域名』**www.baidu.com，而这个域名对应到一个IP地址。

整个过程为了方便理解，我先举个例子：

背景，A和B是多年不联系的老同学，如今A因为家人重病已经家徒四壁，于是想向已经财务自由的B借点钱，在没有互联网的情况下，A只能寄封信给B，然后让B把钱寄给A。

背景，A因为妻子重病，于是要通知给自己的孩子B，让其寄钱回家，在没有互联网的情况下，A只能寄信给B，然后让B把钱寄给A。

1. A寄出的信件标明B地址『XXX省YYY市ZZZ小区』，内容为『家人重病，速记钱来』；
2. 若A知道『B地址』的邮政编码，直接寄出；
3. 若A不知『B地址』的邮政编码，A会问『菜鸟驿站』，『XXX省YYY市ZZZ小区』的邮政编码是多少？
   1. 若『菜鸟驿站』知道『XXX省YYY市ZZZ小区』的邮政编码，返回给A，直接寄出；
   2. 若『菜鸟驿站』不知『XXX省YYY市ZZZ小区』的邮政编码
      1. 『菜鸟驿站』存有全国13个国家级邮政局的邮政编码，而每个国家级邮政局都存有所有省级的邮政编码；
      2. 『菜鸟驿站』先问所有的国家级邮政局，『XXX省邮政局』邮政编码是多少？
      3. 得知『XXX省邮政局』邮政编码，『菜鸟驿站』继续问『XXX省邮政局』，『YYY市邮政局』邮政编码是多少？
      4. 得知『YYY市邮政局』邮政编码，『菜鸟驿站』继续问『YYY市邮政局』，『ZZZ小区邮政局』邮政编码是多少？
      5. 得知『ZZZ小区邮政局』邮政编码，『菜鸟驿站』把邮政编码反馈给A，直接寄出；
4. B收到信之后，按照信封上的通信地址，把钱寄回来；
5. A收到钱，立马去缴费看病。

如图所示：![](/assets/computer.fundamental %281%29.png)

好的，稍微学术一点：

1. 你在浏览器输入『map.google.com』，想要获取Google地图首页内容；
2. 若浏览器知道『map.google.com』的IP地址，直接寄出；
3. 若浏览器不知『map.google.com』的IP地址，浏览器会问『DNS服务器』，『map.google.com』的IP地址是多少？
   1. 若『DNS服务器』知道『map.google.com』的IP地址，返回给浏览器，直接寄出；
   2. 若『DNS服务器』不知『map.google.com』的IP地址
      1. 『DNS服务器』存有世界上13个**根域名服务器**的IP地址，它会先问『根域名服务器』，『.com**权威域名服务器**』IP地址是多少？
      2. 得知『.com权威域名服务器』IP地址，『DNS服务器』继续问『.com权威域名服务器』，『google.com权威域名服务器』IP地址是多少？
      3. 得知『.google.com权威域名服务器』IP地址，『DNS服务器』继续问『.google.com权威域名服务器』，『map.google.com』IP地址是多少？
      4. 得知『map.google.com』IP地址，『DNS服务器』把IP地址反馈给浏览器，直接寄出；
4. 『map.google.com』服务器收到请求后，按照请求中的通信地址，把Google地图的首页内容发送回来；
5. 浏览器收到内容，立马开始渲染地图。

## 3.4 GFW简介

先回到上面那张图，那个紫色的『根域名服务器』，《2009年美国的人权记录》说了，全世界总共就13台，10台都在美国。

每台『根域名服务器』存有诸如.com、.cn、.edu等所有『顶级域名』的『权威域名服务器』的IP地址，感兴趣的话，可以去查看一下这个文件，并不是很大：[root.zone](https://www.internic.net/domain/root.zone)。

因此，你也就明白为什么《人权报告》里有这么一条了吧，理论上来说，它可以使得某些『顶级域名』的解析出问题。

比如，它不告诉你『.cn权威域名服务器』的IP地址，你也就访问所有以.cn结尾的网站了。

当然，『根域名服务器』不会骗你，倘若其他『权威域名服务器』骗你呢？

比如，在国内的『.com权威域名服务器』就是不告诉你『.google.com权威域名服务器』的IP地址，然后你就不能向『.google.com权威域名服务器』询问『map.google.com』的IP地址了，你也就不能访问『map.google.com』以及所有以.google.com结尾的网站了。

北京邮电大学前校长——方滨兴院士所研究设计的[**Great Firewall**](https://zh.wikipedia.org/wiki/防火长城)，其中一项重要工作就是使得『权威域名服务器』骗了你。

## 3.5 小结

* 明白IP地址的概念；
* 明白我们所访问的**域名**其实对应到了一个IP地址，并懂得获取域名的IP地址的过程；
* 明白通信的概念。



